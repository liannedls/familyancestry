{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reselect = require(\"reselect\");\n\nvar _warning = _interopRequireDefault(require(\"warning\"));\n\nvar _ZoomButtons = _interopRequireDefault(require(\"./ZoomButtons\"));\n\nvar _StateDebugView = _interopRequireDefault(require(\"./StateDebugView\"));\n\nvar _Utils = require(\"./Utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar OVERZOOM_TOLERANCE = 0.05;\nvar DOUBLE_TAP_THRESHOLD = 250;\nvar ANIMATION_SPEED = 0.1;\n\nvar isInitialized = function isInitialized(top, left, scale) {\n  return scale !== undefined && left !== undefined && top !== undefined;\n};\n\nvar imageStyle = (0, _reselect.createSelector)(function (state) {\n  return state.top;\n}, function (state) {\n  return state.left;\n}, function (state) {\n  return state.scale;\n}, function (top, left, scale) {\n  var style = {\n    cursor: 'pointer'\n  };\n  return isInitialized(top, left, scale) ? _objectSpread({}, style, {\n    transform: \"translate3d(\".concat(left, \"px, \").concat(top, \"px, 0) scale(\").concat(scale, \")\"),\n    transformOrigin: '0 0'\n  }) : style;\n});\nvar imageOverflow = (0, _reselect.createSelector)(function (state) {\n  return state.top;\n}, function (state) {\n  return state.left;\n}, function (state) {\n  return state.scale;\n}, function (state) {\n  return state.imageDimensions;\n}, function (state) {\n  return state.containerDimensions;\n}, function (top, left, scale, imageDimensions, containerDimensions) {\n  if (!isInitialized(top, left, scale)) {\n    return '';\n  }\n\n  return (0, _Utils.getImageOverflow)(top, left, scale, imageDimensions, containerDimensions);\n});\nvar browserPanActions = (0, _reselect.createSelector)(imageOverflow, function (imageOverflow) {\n  //Determine the panning directions where there is no image overflow and let\n  //the browser handle those directions (e.g., scroll viewport if possible).\n  //Need to replace 'pan-left pan-right' with 'pan-x', etc. otherwise \n  //it is rejected (o_O), therefore explicitly handle each combination.\n  var browserPanX = !imageOverflow.left && !imageOverflow.right ? 'pan-x' //we can't pan the image horizontally, let the browser take it\n  : !imageOverflow.left ? 'pan-left' : !imageOverflow.right ? 'pan-right' : '';\n  var browserPanY = !imageOverflow.top && !imageOverflow.bottom ? 'pan-y' : !imageOverflow.top ? 'pan-up' : !imageOverflow.bottom ? 'pan-down' : '';\n  return [browserPanX, browserPanY].join(' ').trim();\n}); //Ensure the image is not over-panned, and not over- or under-scaled.\n//These constraints must be checked when image changes, and when container is resized.\n\nvar PinchZoomPan = /*#__PURE__*/function (_React$Component) {\n  _inherits(PinchZoomPan, _React$Component);\n\n  function PinchZoomPan() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, PinchZoomPan);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(PinchZoomPan)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {});\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"lastPointerUpTimeStamp\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"lastPanPointerPosition\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"lastPinchLength\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"animation\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"imageRef\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"isImageLoaded\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"originalOverscrollBehaviorY\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleTouchStart\", function (event) {\n      _this.cancelAnimation();\n\n      var touches = event.touches;\n\n      if (touches.length === 2) {\n        _this.lastPinchLength = (0, _Utils.getPinchLength)(touches);\n        _this.lastPanPointerPosition = null;\n      } else if (touches.length === 1) {\n        _this.lastPinchLength = null;\n\n        _this.pointerDown(touches[0]);\n\n        (0, _Utils.tryCancelEvent)(event); //suppress mouse events\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleTouchMove\", function (event) {\n      var touches = event.touches;\n\n      if (touches.length === 2) {\n        _this.pinchChange(touches); //suppress viewport scaling on iOS\n\n\n        (0, _Utils.tryCancelEvent)(event);\n      } else if (touches.length === 1) {\n        var requestedPan = _this.pan(touches[0]);\n\n        if (!_this.controlOverscrollViaCss) {\n          //let the browser handling panning if we are at the edge of the image in \n          //both pan directions, or if we are primarily panning in one direction\n          //and are at the edge in that directino\n          var overflow = imageOverflow(_this.state);\n          var hasOverflowX = requestedPan.left && overflow.left > 0 || requestedPan.right && overflow.right > 0;\n          var hasOverflowY = requestedPan.up && overflow.top > 0 || requestedPan.down && overflow.bottom > 0;\n\n          if (!hasOverflowX && !hasOverflowY) {\n            //no overflow in both directions\n            return;\n          }\n\n          var panX = requestedPan.left || requestedPan.right;\n          var panY = requestedPan.up || requestedPan.down;\n\n          if (panY > 2 * panX && !hasOverflowY) {\n            //primarily panning up or down and no overflow in the Y direction\n            return;\n          }\n\n          if (panX > 2 * panY && !hasOverflowX) {\n            //primarily panning left or right and no overflow in the X direction\n            return;\n          }\n\n          (0, _Utils.tryCancelEvent)(event);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleTouchEnd\", function (event) {\n      _this.cancelAnimation();\n\n      if (event.touches.length === 0 && event.changedTouches.length === 1) {\n        if (_this.lastPointerUpTimeStamp && _this.lastPointerUpTimeStamp + DOUBLE_TAP_THRESHOLD > event.timeStamp) {\n          var pointerPosition = (0, _Utils.getRelativePosition)(event.changedTouches[0], _this.imageRef.parentNode);\n\n          _this.doubleClick(pointerPosition);\n        }\n\n        _this.lastPointerUpTimeStamp = event.timeStamp;\n        (0, _Utils.tryCancelEvent)(event); //suppress mouse events\n      } //We allow transient +/-5% over-pinching.\n      //Animate the bounce back to constraints if applicable.\n\n\n      _this.maybeAdjustCurrentTransform(ANIMATION_SPEED);\n\n      return;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseDown\", function (event) {\n      _this.cancelAnimation();\n\n      _this.pointerDown(event);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseMove\", function (event) {\n      if (!event.buttons) return null;\n\n      _this.pan(event);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseDoubleClick\", function (event) {\n      _this.cancelAnimation();\n\n      var pointerPosition = (0, _Utils.getRelativePosition)(event, _this.imageRef.parentNode);\n\n      _this.doubleClick(pointerPosition);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseWheel\", function (event) {\n      _this.cancelAnimation();\n\n      var point = (0, _Utils.getRelativePosition)(event, _this.imageRef.parentNode);\n\n      if (event.deltaY > 0) {\n        if (_this.state.scale > (0, _Utils.getMinScale)(_this.state, _this.props)) {\n          _this.zoomOut(point);\n\n          (0, _Utils.tryCancelEvent)(event);\n        }\n      } else if (event.deltaY < 0) {\n        if (_this.state.scale < _this.props.maxScale) {\n          _this.zoomIn(point);\n\n          (0, _Utils.tryCancelEvent)(event);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleImageLoad\", function (event) {\n      _this.debug('handleImageLoad');\n\n      _this.isImageLoaded = true;\n\n      _this.maybeHandleDimensionsChanged();\n\n      var onLoad = _react.default.Children.only(_this.props.children).props.onLoad;\n\n      if (typeof onLoad === 'function') {\n        onLoad(event);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleZoomInClick\", function () {\n      _this.cancelAnimation();\n\n      _this.zoomIn();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleZoomOutClick\", function () {\n      _this.cancelAnimation();\n\n      _this.zoomOut();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleWindowResize\", function () {\n      return _this.maybeHandleDimensionsChanged();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleRefImage\", function (ref) {\n      if (_this.imageRef) {\n        _this.cancelAnimation();\n\n        _this.imageRef.removeEventListener('touchmove', _this.handleTouchMove);\n      }\n\n      _this.imageRef = ref;\n\n      if (ref) {\n        _this.imageRef.addEventListener('touchmove', _this.handleTouchMove, {\n          passive: false\n        });\n      }\n\n      var _React$Children$only = _react.default.Children.only(_this.props.children),\n          imageRefProp = _React$Children$only.ref;\n\n      (0, _Utils.setRef)(imageRefProp, ref);\n    });\n\n    return _this;\n  }\n\n  _createClass(PinchZoomPan, [{\n    key: \"pointerDown\",\n    //actions\n    value: function pointerDown(clientPosition) {\n      this.lastPanPointerPosition = (0, _Utils.getRelativePosition)(clientPosition, this.imageRef.parentNode);\n    }\n  }, {\n    key: \"pan\",\n    value: function pan(pointerClientPosition) {\n      if (!this.isTransformInitialized) {\n        return;\n      }\n\n      if (!this.lastPanPointerPosition) {\n        //if we were pinching and lifted a finger\n        this.pointerDown(pointerClientPosition);\n        return 0;\n      }\n\n      var pointerPosition = (0, _Utils.getRelativePosition)(pointerClientPosition, this.imageRef.parentNode);\n      var translateX = pointerPosition.x - this.lastPanPointerPosition.x;\n      var translateY = pointerPosition.y - this.lastPanPointerPosition.y;\n      this.lastPanPointerPosition = pointerPosition;\n      var top = this.state.top + translateY;\n      var left = this.state.left + translateX;\n      this.constrainAndApplyTransform(top, left, this.state.scale, 0, 0);\n      return {\n        up: translateY > 0 ? translateY : 0,\n        down: translateY < 0 ? (0, _Utils.negate)(translateY) : 0,\n        right: translateX < 0 ? (0, _Utils.negate)(translateX) : 0,\n        left: translateX > 0 ? translateX : 0\n      };\n    }\n  }, {\n    key: \"doubleClick\",\n    value: function doubleClick(pointerPosition) {\n      if (String(this.props.doubleTapBehavior).toLowerCase() === 'zoom' && this.state.scale * (1 + OVERZOOM_TOLERANCE) < this.props.maxScale) {\n        this.zoomIn(pointerPosition, ANIMATION_SPEED, 0.3);\n      } else {\n        //reset\n        this.applyInitialTransform(ANIMATION_SPEED);\n      }\n    }\n  }, {\n    key: \"pinchChange\",\n    value: function pinchChange(touches) {\n      var length = (0, _Utils.getPinchLength)(touches);\n      var midpoint = (0, _Utils.getPinchMidpoint)(touches);\n      var scale = this.lastPinchLength ? this.state.scale * length / this.lastPinchLength //sometimes we get a touchchange before a touchstart when pinching\n      : this.state.scale;\n      this.zoom(scale, midpoint, OVERZOOM_TOLERANCE);\n      this.lastPinchLength = length;\n    }\n  }, {\n    key: \"zoomIn\",\n    value: function zoomIn(midpoint) {\n      var speed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var factor = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0.1;\n      midpoint = midpoint || {\n        x: this.state.containerDimensions.width / 2,\n        y: this.state.containerDimensions.height / 2\n      };\n      this.zoom(this.state.scale * (1 + factor), midpoint, 0, speed);\n    }\n  }, {\n    key: \"zoomOut\",\n    value: function zoomOut(midpoint) {\n      midpoint = midpoint || {\n        x: this.state.containerDimensions.width / 2,\n        y: this.state.containerDimensions.height / 2\n      };\n      this.zoom(this.state.scale * 0.9, midpoint, 0);\n    }\n  }, {\n    key: \"zoom\",\n    value: function zoom(requestedScale, containerRelativePoint, tolerance) {\n      var speed = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n      if (!this.isTransformInitialized) {\n        return;\n      }\n\n      var _this$state = this.state,\n          scale = _this$state.scale,\n          top = _this$state.top,\n          left = _this$state.left;\n      var imageRelativePoint = {\n        top: containerRelativePoint.y - top,\n        left: containerRelativePoint.x - left\n      };\n      var nextScale = this.getConstrainedScale(requestedScale, tolerance);\n      var incrementalScalePercentage = (nextScale - scale) / scale;\n      var translateY = imageRelativePoint.top * incrementalScalePercentage;\n      var translateX = imageRelativePoint.left * incrementalScalePercentage;\n      var nextTop = top - translateY;\n      var nextLeft = left - translateX;\n      this.constrainAndApplyTransform(nextTop, nextLeft, nextScale, tolerance, speed);\n    } //compare stored dimensions to actual dimensions; capture actual dimensions if different\n\n  }, {\n    key: \"maybeHandleDimensionsChanged\",\n    value: function maybeHandleDimensionsChanged() {\n      var _this2 = this;\n\n      if (this.isImageReady) {\n        var containerDimensions = (0, _Utils.getContainerDimensions)(this.imageRef);\n        var imageDimensions = (0, _Utils.getDimensions)(this.imageRef);\n\n        if (!(0, _Utils.isEqualDimensions)(containerDimensions, (0, _Utils.getDimensions)(this.state.containerDimensions)) || !(0, _Utils.isEqualDimensions)(imageDimensions, (0, _Utils.getDimensions)(this.state.imageDimensions))) {\n          this.cancelAnimation(); //capture new dimensions\n\n          this.setState({\n            containerDimensions: containerDimensions,\n            imageDimensions: imageDimensions\n          }, function () {\n            //When image loads and image dimensions are first established, apply initial transform.\n            //If dimensions change, constraints change; current transform may need to be adjusted.\n            //Transforms depend on state, so wait until state is updated.\n            if (!_this2.isTransformInitialized) {\n              _this2.applyInitialTransform();\n            } else {\n              _this2.maybeAdjustCurrentTransform();\n            }\n          });\n          this.debug(\"Dimensions changed: Container: \".concat(containerDimensions.width, \", \").concat(containerDimensions.height, \", Image: \").concat(imageDimensions.width, \", \").concat(imageDimensions.height));\n        }\n      } else {\n        this.debug('Image not loaded');\n      }\n    } //transformation methods\n    //Zooming and panning cause transform to be requested.\n\n  }, {\n    key: \"constrainAndApplyTransform\",\n    value: function constrainAndApplyTransform(requestedTop, requestedLeft, requestedScale, tolerance) {\n      var speed = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n      var requestedTransform = {\n        top: requestedTop,\n        left: requestedLeft,\n        scale: requestedScale\n      };\n      this.debug(\"Requesting transform: left \".concat(requestedLeft, \", top \").concat(requestedTop, \", scale \").concat(requestedScale)); //Correct the transform if needed to prevent overpanning and overzooming\n\n      var transform = this.getCorrectedTransform(requestedTransform, tolerance) || requestedTransform;\n      this.debug(\"Applying transform: left \".concat(transform.left, \", top \").concat(transform.top, \", scale \").concat(transform.scale));\n\n      if ((0, _Utils.isEqualTransform)(transform, this.state)) {\n        return false;\n      }\n\n      this.applyTransform(transform, speed);\n      return true;\n    }\n  }, {\n    key: \"applyTransform\",\n    value: function applyTransform(_ref, speed) {\n      var _this3 = this;\n\n      var top = _ref.top,\n          left = _ref.left,\n          scale = _ref.scale;\n\n      if (speed > 0) {\n        var frame = function frame() {\n          var translateY = top - _this3.state.top;\n          var translateX = left - _this3.state.left;\n          var translateScale = scale - _this3.state.scale;\n          var nextTransform = {\n            top: (0, _Utils.snapToTarget)(_this3.state.top + speed * translateY, top, 1),\n            left: (0, _Utils.snapToTarget)(_this3.state.left + speed * translateX, left, 1),\n            scale: (0, _Utils.snapToTarget)(_this3.state.scale + speed * translateScale, scale, 0.001)\n          }; //animation runs until we reach the target\n\n          if (!(0, _Utils.isEqualTransform)(nextTransform, _this3.state)) {\n            _this3.setState(nextTransform, function () {\n              return _this3.animation = requestAnimationFrame(frame);\n            });\n          }\n        };\n\n        this.animation = requestAnimationFrame(frame);\n      } else {\n        this.setState({\n          top: top,\n          left: left,\n          scale: scale\n        });\n      }\n    } //Returns constrained scale when requested scale is outside min/max with tolerance, otherwise returns requested scale\n\n  }, {\n    key: \"getConstrainedScale\",\n    value: function getConstrainedScale(requestedScale, tolerance) {\n      var lowerBoundFactor = 1.0 - tolerance;\n      var upperBoundFactor = 1.0 + tolerance;\n      return (0, _Utils.constrain)((0, _Utils.getMinScale)(this.state, this.props) * lowerBoundFactor, this.props.maxScale * upperBoundFactor, requestedScale);\n    } //Returns constrained transform when requested transform is outside constraints with tolerance, otherwise returns null\n\n  }, {\n    key: \"getCorrectedTransform\",\n    value: function getCorrectedTransform(requestedTransform, tolerance) {\n      var scale = this.getConstrainedScale(requestedTransform.scale, tolerance); //get dimensions by which scaled image overflows container\n\n      var negativeSpace = this.calculateNegativeSpace(scale);\n      var overflow = {\n        width: Math.max(0, (0, _Utils.negate)(negativeSpace.width)),\n        height: Math.max(0, (0, _Utils.negate)(negativeSpace.height))\n      }; //if image overflows container, prevent moving by more than the overflow\n      //example: overflow.height = 100, tolerance = 0.05 => top is constrained between -105 and +5\n\n      var _this$props = this.props,\n          position = _this$props.position,\n          initialTop = _this$props.initialTop,\n          initialLeft = _this$props.initialLeft;\n      var _this$state2 = this.state,\n          imageDimensions = _this$state2.imageDimensions,\n          containerDimensions = _this$state2.containerDimensions;\n      var upperBoundFactor = 1.0 + tolerance;\n      var top = overflow.height ? (0, _Utils.constrain)((0, _Utils.negate)(overflow.height) * upperBoundFactor, overflow.height * upperBoundFactor - overflow.height, requestedTransform.top) : position === 'center' ? (containerDimensions.height - imageDimensions.height * scale) / 2 : initialTop || 0;\n      var left = overflow.width ? (0, _Utils.constrain)((0, _Utils.negate)(overflow.width) * upperBoundFactor, overflow.width * upperBoundFactor - overflow.width, requestedTransform.left) : position === 'center' ? (containerDimensions.width - imageDimensions.width * scale) / 2 : initialLeft || 0;\n      var constrainedTransform = {\n        top: top,\n        left: left,\n        scale: scale\n      };\n      return (0, _Utils.isEqualTransform)(constrainedTransform, requestedTransform) ? null : constrainedTransform;\n    } //Ensure current transform is within constraints\n\n  }, {\n    key: \"maybeAdjustCurrentTransform\",\n    value: function maybeAdjustCurrentTransform() {\n      var speed = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var correctedTransform;\n\n      if (correctedTransform = this.getCorrectedTransform(this.state, 0)) {\n        this.applyTransform(correctedTransform, speed);\n      }\n    }\n  }, {\n    key: \"applyInitialTransform\",\n    value: function applyInitialTransform() {\n      var speed = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var _this$state3 = this.state,\n          imageDimensions = _this$state3.imageDimensions,\n          containerDimensions = _this$state3.containerDimensions;\n      var _this$props2 = this.props,\n          position = _this$props2.position,\n          initialScale = _this$props2.initialScale,\n          maxScale = _this$props2.maxScale,\n          initialTop = _this$props2.initialTop,\n          initialLeft = _this$props2.initialLeft;\n      var scale = String(initialScale).toLowerCase() === 'auto' ? (0, _Utils.getAutofitScale)(containerDimensions, imageDimensions) : initialScale;\n      var minScale = (0, _Utils.getMinScale)(this.state, this.props);\n\n      if (minScale > maxScale) {\n        (0, _warning.default)(false, 'minScale cannot exceed maxScale.');\n        return;\n      }\n\n      if (scale < minScale || scale > maxScale) {\n        (0, _warning.default)(false, 'initialScale must be between minScale and maxScale.');\n        return;\n      }\n\n      var initialPosition;\n\n      if (position === 'center') {\n        (0, _warning.default)(initialTop === undefined, 'initialTop prop should not be supplied with position=center. It was ignored.');\n        (0, _warning.default)(initialLeft === undefined, 'initialLeft prop should not be supplied with position=center. It was ignored.');\n        initialPosition = {\n          top: (containerDimensions.width - imageDimensions.width * scale) / 2,\n          left: (containerDimensions.height - imageDimensions.height * scale) / 2\n        };\n      } else {\n        initialPosition = {\n          top: initialTop || 0,\n          left: initialLeft || 0\n        };\n      }\n\n      this.constrainAndApplyTransform(initialPosition.top, initialPosition.left, scale, 0, speed);\n    } //lifecycle methods\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var childElement = _react.default.Children.only(this.props.children);\n\n      var _this$props3 = this.props,\n          zoomButtons = _this$props3.zoomButtons,\n          maxScale = _this$props3.maxScale,\n          debug = _this$props3.debug;\n      var scale = this.state.scale;\n      var touchAction = this.controlOverscrollViaCss ? browserPanActions(this.state) || 'none' : undefined;\n      var containerStyle = {\n        width: '100%',\n        height: '100%',\n        overflow: 'hidden',\n        touchAction: touchAction\n      };\n      return _react.default.createElement(\"div\", {\n        style: containerStyle\n      }, zoomButtons && this.isImageReady && this.isTransformInitialized && _react.default.createElement(_ZoomButtons.default, {\n        scale: scale,\n        minScale: (0, _Utils.getMinScale)(this.state, this.props),\n        maxScale: maxScale,\n        onZoomOutClick: this.handleZoomOutClick,\n        onZoomInClick: this.handleZoomInClick\n      }), debug && _react.default.createElement(_StateDebugView.default, _extends({}, this.state, {\n        overflow: imageOverflow(this.state)\n      })), _react.default.cloneElement(childElement, {\n        onTouchStart: this.handleTouchStart,\n        onTouchEnd: this.handleTouchEnd,\n        onMouseDown: this.handleMouseDown,\n        onMouseMove: this.handleMouseMove,\n        onDoubleClick: this.handleMouseDoubleClick,\n        onWheel: this.handleMouseWheel,\n        onDragStart: _Utils.tryCancelEvent,\n        onLoad: this.handleImageLoad,\n        onContextMenu: _Utils.tryCancelEvent,\n        ref: this.handleRefImage,\n        style: imageStyle(this.state)\n      }));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener(\"resize\", this.handleWindowResize);\n      this.maybeHandleDimensionsChanged();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      this.maybeHandleDimensionsChanged();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.cancelAnimation();\n      this.imageRef.removeEventListener('touchmove', this.handleTouchMove);\n      window.removeEventListener('resize', this.handleWindowResize);\n    }\n  }, {\n    key: \"calculateNegativeSpace\",\n    value: function calculateNegativeSpace(scale) {\n      //get difference in dimension between container and scaled image\n      var _this$state4 = this.state,\n          containerDimensions = _this$state4.containerDimensions,\n          imageDimensions = _this$state4.imageDimensions;\n      var width = containerDimensions.width - scale * imageDimensions.width;\n      var height = containerDimensions.height - scale * imageDimensions.height;\n      return {\n        width: width,\n        height: height\n      };\n    }\n  }, {\n    key: \"cancelAnimation\",\n    value: function cancelAnimation() {\n      if (this.animation) {\n        cancelAnimationFrame(this.animation);\n      }\n    }\n  }, {\n    key: \"debug\",\n    value: function debug(message) {\n      if (this.props.debug) {\n        console.log(message);\n      }\n    }\n  }, {\n    key: \"isImageReady\",\n    get: function get() {\n      return this.isImageLoaded || this.imageRef && this.imageRef.tagName !== 'IMG';\n    }\n  }, {\n    key: \"isTransformInitialized\",\n    get: function get() {\n      return isInitialized(this.state.top, this.state.left, this.state.scale);\n    }\n  }, {\n    key: \"controlOverscrollViaCss\",\n    get: function get() {\n      return window.CSS && window.CSS.supports('touch-action', 'pan-up');\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, prevState) {\n      if (nextProps.initialTop !== prevState.initialTop || nextProps.initialLeft !== prevState.initialLeft || nextProps.initialScale !== prevState.initialScale || nextProps.position !== prevState.position) {\n        return {\n          position: nextProps.position,\n          initialScale: nextProps.initialScale,\n          initialTop: nextProps.initialTop,\n          initialLeft: nextProps.initialLeft\n        };\n      } else {\n        return null;\n      }\n    }\n  }]);\n\n  return PinchZoomPan;\n}(_react.default.Component);\n\nexports.default = PinchZoomPan;\nPinchZoomPan.defaultProps = {\n  initialScale: 'auto',\n  minScale: 'auto',\n  maxScale: 1,\n  position: 'topLeft',\n  zoomButtons: true,\n  doubleTapBehavior: 'reset'\n};\nPinchZoomPan.propTypes = {\n  children: _propTypes.default.element.isRequired,\n  initialScale: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string]),\n  minScale: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string]),\n  maxScale: _propTypes.default.number,\n  position: _propTypes.default.oneOf(['topLeft', 'center']),\n  zoomButtons: _propTypes.default.bool,\n  doubleTapBehavior: _propTypes.default.oneOf(['reset', 'zoom']),\n  initialTop: _propTypes.default.number,\n  initialLeft: _propTypes.default.number\n};","map":{"version":3,"sources":["C:/Users/lianne/mygit/familyancestry/node_modules/react-responsive-pinch-zoom-pan/dist/PinchZoomPan.js"],"names":["Object","defineProperty","exports","value","default","_react","_interopRequireDefault","require","_propTypes","_reselect","_warning","_ZoomButtons","_StateDebugView","_Utils","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","_extends","assign","target","i","arguments","length","source","key","hasOwnProperty","call","apply","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","enumerable","configurable","writable","_createClass","protoProps","staticProps","_possibleConstructorReturn","self","_assertThisInitialized","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_inherits","subClass","superClass","create","_setPrototypeOf","p","ReferenceError","_objectSpread","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","_defineProperty","OVERZOOM_TOLERANCE","DOUBLE_TAP_THRESHOLD","ANIMATION_SPEED","isInitialized","top","left","scale","undefined","imageStyle","createSelector","state","style","cursor","transform","transformOrigin","imageOverflow","imageDimensions","containerDimensions","getImageOverflow","browserPanActions","browserPanX","right","browserPanY","bottom","join","trim","PinchZoomPan","_React$Component","_getPrototypeOf2","_this","_len","args","Array","_key","event","cancelAnimation","touches","lastPinchLength","getPinchLength","lastPanPointerPosition","pointerDown","tryCancelEvent","pinchChange","requestedPan","pan","controlOverscrollViaCss","overflow","hasOverflowX","hasOverflowY","up","down","panX","panY","changedTouches","lastPointerUpTimeStamp","timeStamp","pointerPosition","getRelativePosition","imageRef","parentNode","doubleClick","maybeAdjustCurrentTransform","buttons","point","deltaY","getMinScale","zoomOut","maxScale","zoomIn","debug","isImageLoaded","maybeHandleDimensionsChanged","onLoad","Children","only","children","ref","removeEventListener","handleTouchMove","addEventListener","passive","_React$Children$only","imageRefProp","setRef","clientPosition","pointerClientPosition","isTransformInitialized","translateX","x","translateY","y","constrainAndApplyTransform","negate","String","doubleTapBehavior","toLowerCase","applyInitialTransform","midpoint","getPinchMidpoint","zoom","speed","factor","width","height","requestedScale","containerRelativePoint","tolerance","_this$state","imageRelativePoint","nextScale","getConstrainedScale","incrementalScalePercentage","nextTop","nextLeft","_this2","isImageReady","getContainerDimensions","getDimensions","isEqualDimensions","setState","requestedTop","requestedLeft","requestedTransform","getCorrectedTransform","isEqualTransform","applyTransform","_ref","_this3","frame","translateScale","nextTransform","snapToTarget","animation","requestAnimationFrame","lowerBoundFactor","upperBoundFactor","constrain","negativeSpace","calculateNegativeSpace","Math","max","_this$props","position","initialTop","initialLeft","_this$state2","constrainedTransform","correctedTransform","_this$state3","_this$props2","initialScale","getAutofitScale","minScale","initialPosition","render","childElement","_this$props3","zoomButtons","touchAction","containerStyle","createElement","onZoomOutClick","handleZoomOutClick","onZoomInClick","handleZoomInClick","cloneElement","onTouchStart","handleTouchStart","onTouchEnd","handleTouchEnd","onMouseDown","handleMouseDown","onMouseMove","handleMouseMove","onDoubleClick","handleMouseDoubleClick","onWheel","handleMouseWheel","onDragStart","handleImageLoad","onContextMenu","handleRefImage","componentDidMount","window","handleWindowResize","componentDidUpdate","prevProps","prevState","componentWillUnmount","_this$state4","cancelAnimationFrame","message","console","log","get","tagName","CSS","supports","getDerivedStateFromProps","nextProps","Component","defaultProps","propTypes","element","isRequired","oneOfType","number","string","oneOf","bool"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reselect = require(\"reselect\");\n\nvar _warning = _interopRequireDefault(require(\"warning\"));\n\nvar _ZoomButtons = _interopRequireDefault(require(\"./ZoomButtons\"));\n\nvar _StateDebugView = _interopRequireDefault(require(\"./StateDebugView\"));\n\nvar _Utils = require(\"./Utils\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar OVERZOOM_TOLERANCE = 0.05;\nvar DOUBLE_TAP_THRESHOLD = 250;\nvar ANIMATION_SPEED = 0.1;\n\nvar isInitialized = function isInitialized(top, left, scale) {\n  return scale !== undefined && left !== undefined && top !== undefined;\n};\n\nvar imageStyle = (0, _reselect.createSelector)(function (state) {\n  return state.top;\n}, function (state) {\n  return state.left;\n}, function (state) {\n  return state.scale;\n}, function (top, left, scale) {\n  var style = {\n    cursor: 'pointer'\n  };\n  return isInitialized(top, left, scale) ? _objectSpread({}, style, {\n    transform: \"translate3d(\".concat(left, \"px, \").concat(top, \"px, 0) scale(\").concat(scale, \")\"),\n    transformOrigin: '0 0'\n  }) : style;\n});\nvar imageOverflow = (0, _reselect.createSelector)(function (state) {\n  return state.top;\n}, function (state) {\n  return state.left;\n}, function (state) {\n  return state.scale;\n}, function (state) {\n  return state.imageDimensions;\n}, function (state) {\n  return state.containerDimensions;\n}, function (top, left, scale, imageDimensions, containerDimensions) {\n  if (!isInitialized(top, left, scale)) {\n    return '';\n  }\n\n  return (0, _Utils.getImageOverflow)(top, left, scale, imageDimensions, containerDimensions);\n});\nvar browserPanActions = (0, _reselect.createSelector)(imageOverflow, function (imageOverflow) {\n  //Determine the panning directions where there is no image overflow and let\n  //the browser handle those directions (e.g., scroll viewport if possible).\n  //Need to replace 'pan-left pan-right' with 'pan-x', etc. otherwise \n  //it is rejected (o_O), therefore explicitly handle each combination.\n  var browserPanX = !imageOverflow.left && !imageOverflow.right ? 'pan-x' //we can't pan the image horizontally, let the browser take it\n  : !imageOverflow.left ? 'pan-left' : !imageOverflow.right ? 'pan-right' : '';\n  var browserPanY = !imageOverflow.top && !imageOverflow.bottom ? 'pan-y' : !imageOverflow.top ? 'pan-up' : !imageOverflow.bottom ? 'pan-down' : '';\n  return [browserPanX, browserPanY].join(' ').trim();\n}); //Ensure the image is not over-panned, and not over- or under-scaled.\n//These constraints must be checked when image changes, and when container is resized.\n\nvar PinchZoomPan =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(PinchZoomPan, _React$Component);\n\n  function PinchZoomPan() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, PinchZoomPan);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(PinchZoomPan)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {});\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"lastPointerUpTimeStamp\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"lastPanPointerPosition\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"lastPinchLength\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"animation\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"imageRef\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"isImageLoaded\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"originalOverscrollBehaviorY\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleTouchStart\", function (event) {\n      _this.cancelAnimation();\n\n      var touches = event.touches;\n\n      if (touches.length === 2) {\n        _this.lastPinchLength = (0, _Utils.getPinchLength)(touches);\n        _this.lastPanPointerPosition = null;\n      } else if (touches.length === 1) {\n        _this.lastPinchLength = null;\n\n        _this.pointerDown(touches[0]);\n\n        (0, _Utils.tryCancelEvent)(event); //suppress mouse events\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleTouchMove\", function (event) {\n      var touches = event.touches;\n\n      if (touches.length === 2) {\n        _this.pinchChange(touches); //suppress viewport scaling on iOS\n\n\n        (0, _Utils.tryCancelEvent)(event);\n      } else if (touches.length === 1) {\n        var requestedPan = _this.pan(touches[0]);\n\n        if (!_this.controlOverscrollViaCss) {\n          //let the browser handling panning if we are at the edge of the image in \n          //both pan directions, or if we are primarily panning in one direction\n          //and are at the edge in that directino\n          var overflow = imageOverflow(_this.state);\n          var hasOverflowX = requestedPan.left && overflow.left > 0 || requestedPan.right && overflow.right > 0;\n          var hasOverflowY = requestedPan.up && overflow.top > 0 || requestedPan.down && overflow.bottom > 0;\n\n          if (!hasOverflowX && !hasOverflowY) {\n            //no overflow in both directions\n            return;\n          }\n\n          var panX = requestedPan.left || requestedPan.right;\n          var panY = requestedPan.up || requestedPan.down;\n\n          if (panY > 2 * panX && !hasOverflowY) {\n            //primarily panning up or down and no overflow in the Y direction\n            return;\n          }\n\n          if (panX > 2 * panY && !hasOverflowX) {\n            //primarily panning left or right and no overflow in the X direction\n            return;\n          }\n\n          (0, _Utils.tryCancelEvent)(event);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleTouchEnd\", function (event) {\n      _this.cancelAnimation();\n\n      if (event.touches.length === 0 && event.changedTouches.length === 1) {\n        if (_this.lastPointerUpTimeStamp && _this.lastPointerUpTimeStamp + DOUBLE_TAP_THRESHOLD > event.timeStamp) {\n          var pointerPosition = (0, _Utils.getRelativePosition)(event.changedTouches[0], _this.imageRef.parentNode);\n\n          _this.doubleClick(pointerPosition);\n        }\n\n        _this.lastPointerUpTimeStamp = event.timeStamp;\n        (0, _Utils.tryCancelEvent)(event); //suppress mouse events\n      } //We allow transient +/-5% over-pinching.\n      //Animate the bounce back to constraints if applicable.\n\n\n      _this.maybeAdjustCurrentTransform(ANIMATION_SPEED);\n\n      return;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseDown\", function (event) {\n      _this.cancelAnimation();\n\n      _this.pointerDown(event);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseMove\", function (event) {\n      if (!event.buttons) return null;\n\n      _this.pan(event);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseDoubleClick\", function (event) {\n      _this.cancelAnimation();\n\n      var pointerPosition = (0, _Utils.getRelativePosition)(event, _this.imageRef.parentNode);\n\n      _this.doubleClick(pointerPosition);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleMouseWheel\", function (event) {\n      _this.cancelAnimation();\n\n      var point = (0, _Utils.getRelativePosition)(event, _this.imageRef.parentNode);\n\n      if (event.deltaY > 0) {\n        if (_this.state.scale > (0, _Utils.getMinScale)(_this.state, _this.props)) {\n          _this.zoomOut(point);\n\n          (0, _Utils.tryCancelEvent)(event);\n        }\n      } else if (event.deltaY < 0) {\n        if (_this.state.scale < _this.props.maxScale) {\n          _this.zoomIn(point);\n\n          (0, _Utils.tryCancelEvent)(event);\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleImageLoad\", function (event) {\n      _this.debug('handleImageLoad');\n\n      _this.isImageLoaded = true;\n\n      _this.maybeHandleDimensionsChanged();\n\n      var onLoad = _react.default.Children.only(_this.props.children).props.onLoad;\n\n      if (typeof onLoad === 'function') {\n        onLoad(event);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleZoomInClick\", function () {\n      _this.cancelAnimation();\n\n      _this.zoomIn();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleZoomOutClick\", function () {\n      _this.cancelAnimation();\n\n      _this.zoomOut();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleWindowResize\", function () {\n      return _this.maybeHandleDimensionsChanged();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleRefImage\", function (ref) {\n      if (_this.imageRef) {\n        _this.cancelAnimation();\n\n        _this.imageRef.removeEventListener('touchmove', _this.handleTouchMove);\n      }\n\n      _this.imageRef = ref;\n\n      if (ref) {\n        _this.imageRef.addEventListener('touchmove', _this.handleTouchMove, {\n          passive: false\n        });\n      }\n\n      var _React$Children$only = _react.default.Children.only(_this.props.children),\n          imageRefProp = _React$Children$only.ref;\n\n      (0, _Utils.setRef)(imageRefProp, ref);\n    });\n\n    return _this;\n  }\n\n  _createClass(PinchZoomPan, [{\n    key: \"pointerDown\",\n    //actions\n    value: function pointerDown(clientPosition) {\n      this.lastPanPointerPosition = (0, _Utils.getRelativePosition)(clientPosition, this.imageRef.parentNode);\n    }\n  }, {\n    key: \"pan\",\n    value: function pan(pointerClientPosition) {\n      if (!this.isTransformInitialized) {\n        return;\n      }\n\n      if (!this.lastPanPointerPosition) {\n        //if we were pinching and lifted a finger\n        this.pointerDown(pointerClientPosition);\n        return 0;\n      }\n\n      var pointerPosition = (0, _Utils.getRelativePosition)(pointerClientPosition, this.imageRef.parentNode);\n      var translateX = pointerPosition.x - this.lastPanPointerPosition.x;\n      var translateY = pointerPosition.y - this.lastPanPointerPosition.y;\n      this.lastPanPointerPosition = pointerPosition;\n      var top = this.state.top + translateY;\n      var left = this.state.left + translateX;\n      this.constrainAndApplyTransform(top, left, this.state.scale, 0, 0);\n      return {\n        up: translateY > 0 ? translateY : 0,\n        down: translateY < 0 ? (0, _Utils.negate)(translateY) : 0,\n        right: translateX < 0 ? (0, _Utils.negate)(translateX) : 0,\n        left: translateX > 0 ? translateX : 0\n      };\n    }\n  }, {\n    key: \"doubleClick\",\n    value: function doubleClick(pointerPosition) {\n      if (String(this.props.doubleTapBehavior).toLowerCase() === 'zoom' && this.state.scale * (1 + OVERZOOM_TOLERANCE) < this.props.maxScale) {\n        this.zoomIn(pointerPosition, ANIMATION_SPEED, 0.3);\n      } else {\n        //reset\n        this.applyInitialTransform(ANIMATION_SPEED);\n      }\n    }\n  }, {\n    key: \"pinchChange\",\n    value: function pinchChange(touches) {\n      var length = (0, _Utils.getPinchLength)(touches);\n      var midpoint = (0, _Utils.getPinchMidpoint)(touches);\n      var scale = this.lastPinchLength ? this.state.scale * length / this.lastPinchLength //sometimes we get a touchchange before a touchstart when pinching\n      : this.state.scale;\n      this.zoom(scale, midpoint, OVERZOOM_TOLERANCE);\n      this.lastPinchLength = length;\n    }\n  }, {\n    key: \"zoomIn\",\n    value: function zoomIn(midpoint) {\n      var speed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var factor = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0.1;\n      midpoint = midpoint || {\n        x: this.state.containerDimensions.width / 2,\n        y: this.state.containerDimensions.height / 2\n      };\n      this.zoom(this.state.scale * (1 + factor), midpoint, 0, speed);\n    }\n  }, {\n    key: \"zoomOut\",\n    value: function zoomOut(midpoint) {\n      midpoint = midpoint || {\n        x: this.state.containerDimensions.width / 2,\n        y: this.state.containerDimensions.height / 2\n      };\n      this.zoom(this.state.scale * 0.9, midpoint, 0);\n    }\n  }, {\n    key: \"zoom\",\n    value: function zoom(requestedScale, containerRelativePoint, tolerance) {\n      var speed = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n      if (!this.isTransformInitialized) {\n        return;\n      }\n\n      var _this$state = this.state,\n          scale = _this$state.scale,\n          top = _this$state.top,\n          left = _this$state.left;\n      var imageRelativePoint = {\n        top: containerRelativePoint.y - top,\n        left: containerRelativePoint.x - left\n      };\n      var nextScale = this.getConstrainedScale(requestedScale, tolerance);\n      var incrementalScalePercentage = (nextScale - scale) / scale;\n      var translateY = imageRelativePoint.top * incrementalScalePercentage;\n      var translateX = imageRelativePoint.left * incrementalScalePercentage;\n      var nextTop = top - translateY;\n      var nextLeft = left - translateX;\n      this.constrainAndApplyTransform(nextTop, nextLeft, nextScale, tolerance, speed);\n    } //compare stored dimensions to actual dimensions; capture actual dimensions if different\n\n  }, {\n    key: \"maybeHandleDimensionsChanged\",\n    value: function maybeHandleDimensionsChanged() {\n      var _this2 = this;\n\n      if (this.isImageReady) {\n        var containerDimensions = (0, _Utils.getContainerDimensions)(this.imageRef);\n        var imageDimensions = (0, _Utils.getDimensions)(this.imageRef);\n\n        if (!(0, _Utils.isEqualDimensions)(containerDimensions, (0, _Utils.getDimensions)(this.state.containerDimensions)) || !(0, _Utils.isEqualDimensions)(imageDimensions, (0, _Utils.getDimensions)(this.state.imageDimensions))) {\n          this.cancelAnimation(); //capture new dimensions\n\n          this.setState({\n            containerDimensions: containerDimensions,\n            imageDimensions: imageDimensions\n          }, function () {\n            //When image loads and image dimensions are first established, apply initial transform.\n            //If dimensions change, constraints change; current transform may need to be adjusted.\n            //Transforms depend on state, so wait until state is updated.\n            if (!_this2.isTransformInitialized) {\n              _this2.applyInitialTransform();\n            } else {\n              _this2.maybeAdjustCurrentTransform();\n            }\n          });\n          this.debug(\"Dimensions changed: Container: \".concat(containerDimensions.width, \", \").concat(containerDimensions.height, \", Image: \").concat(imageDimensions.width, \", \").concat(imageDimensions.height));\n        }\n      } else {\n        this.debug('Image not loaded');\n      }\n    } //transformation methods\n    //Zooming and panning cause transform to be requested.\n\n  }, {\n    key: \"constrainAndApplyTransform\",\n    value: function constrainAndApplyTransform(requestedTop, requestedLeft, requestedScale, tolerance) {\n      var speed = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n      var requestedTransform = {\n        top: requestedTop,\n        left: requestedLeft,\n        scale: requestedScale\n      };\n      this.debug(\"Requesting transform: left \".concat(requestedLeft, \", top \").concat(requestedTop, \", scale \").concat(requestedScale)); //Correct the transform if needed to prevent overpanning and overzooming\n\n      var transform = this.getCorrectedTransform(requestedTransform, tolerance) || requestedTransform;\n      this.debug(\"Applying transform: left \".concat(transform.left, \", top \").concat(transform.top, \", scale \").concat(transform.scale));\n\n      if ((0, _Utils.isEqualTransform)(transform, this.state)) {\n        return false;\n      }\n\n      this.applyTransform(transform, speed);\n      return true;\n    }\n  }, {\n    key: \"applyTransform\",\n    value: function applyTransform(_ref, speed) {\n      var _this3 = this;\n\n      var top = _ref.top,\n          left = _ref.left,\n          scale = _ref.scale;\n\n      if (speed > 0) {\n        var frame = function frame() {\n          var translateY = top - _this3.state.top;\n          var translateX = left - _this3.state.left;\n          var translateScale = scale - _this3.state.scale;\n          var nextTransform = {\n            top: (0, _Utils.snapToTarget)(_this3.state.top + speed * translateY, top, 1),\n            left: (0, _Utils.snapToTarget)(_this3.state.left + speed * translateX, left, 1),\n            scale: (0, _Utils.snapToTarget)(_this3.state.scale + speed * translateScale, scale, 0.001)\n          }; //animation runs until we reach the target\n\n          if (!(0, _Utils.isEqualTransform)(nextTransform, _this3.state)) {\n            _this3.setState(nextTransform, function () {\n              return _this3.animation = requestAnimationFrame(frame);\n            });\n          }\n        };\n\n        this.animation = requestAnimationFrame(frame);\n      } else {\n        this.setState({\n          top: top,\n          left: left,\n          scale: scale\n        });\n      }\n    } //Returns constrained scale when requested scale is outside min/max with tolerance, otherwise returns requested scale\n\n  }, {\n    key: \"getConstrainedScale\",\n    value: function getConstrainedScale(requestedScale, tolerance) {\n      var lowerBoundFactor = 1.0 - tolerance;\n      var upperBoundFactor = 1.0 + tolerance;\n      return (0, _Utils.constrain)((0, _Utils.getMinScale)(this.state, this.props) * lowerBoundFactor, this.props.maxScale * upperBoundFactor, requestedScale);\n    } //Returns constrained transform when requested transform is outside constraints with tolerance, otherwise returns null\n\n  }, {\n    key: \"getCorrectedTransform\",\n    value: function getCorrectedTransform(requestedTransform, tolerance) {\n      var scale = this.getConstrainedScale(requestedTransform.scale, tolerance); //get dimensions by which scaled image overflows container\n\n      var negativeSpace = this.calculateNegativeSpace(scale);\n      var overflow = {\n        width: Math.max(0, (0, _Utils.negate)(negativeSpace.width)),\n        height: Math.max(0, (0, _Utils.negate)(negativeSpace.height))\n      }; //if image overflows container, prevent moving by more than the overflow\n      //example: overflow.height = 100, tolerance = 0.05 => top is constrained between -105 and +5\n\n      var _this$props = this.props,\n          position = _this$props.position,\n          initialTop = _this$props.initialTop,\n          initialLeft = _this$props.initialLeft;\n      var _this$state2 = this.state,\n          imageDimensions = _this$state2.imageDimensions,\n          containerDimensions = _this$state2.containerDimensions;\n      var upperBoundFactor = 1.0 + tolerance;\n      var top = overflow.height ? (0, _Utils.constrain)((0, _Utils.negate)(overflow.height) * upperBoundFactor, overflow.height * upperBoundFactor - overflow.height, requestedTransform.top) : position === 'center' ? (containerDimensions.height - imageDimensions.height * scale) / 2 : initialTop || 0;\n      var left = overflow.width ? (0, _Utils.constrain)((0, _Utils.negate)(overflow.width) * upperBoundFactor, overflow.width * upperBoundFactor - overflow.width, requestedTransform.left) : position === 'center' ? (containerDimensions.width - imageDimensions.width * scale) / 2 : initialLeft || 0;\n      var constrainedTransform = {\n        top: top,\n        left: left,\n        scale: scale\n      };\n      return (0, _Utils.isEqualTransform)(constrainedTransform, requestedTransform) ? null : constrainedTransform;\n    } //Ensure current transform is within constraints\n\n  }, {\n    key: \"maybeAdjustCurrentTransform\",\n    value: function maybeAdjustCurrentTransform() {\n      var speed = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var correctedTransform;\n\n      if (correctedTransform = this.getCorrectedTransform(this.state, 0)) {\n        this.applyTransform(correctedTransform, speed);\n      }\n    }\n  }, {\n    key: \"applyInitialTransform\",\n    value: function applyInitialTransform() {\n      var speed = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      var _this$state3 = this.state,\n          imageDimensions = _this$state3.imageDimensions,\n          containerDimensions = _this$state3.containerDimensions;\n      var _this$props2 = this.props,\n          position = _this$props2.position,\n          initialScale = _this$props2.initialScale,\n          maxScale = _this$props2.maxScale,\n          initialTop = _this$props2.initialTop,\n          initialLeft = _this$props2.initialLeft;\n      var scale = String(initialScale).toLowerCase() === 'auto' ? (0, _Utils.getAutofitScale)(containerDimensions, imageDimensions) : initialScale;\n      var minScale = (0, _Utils.getMinScale)(this.state, this.props);\n\n      if (minScale > maxScale) {\n        (0, _warning.default)(false, 'minScale cannot exceed maxScale.');\n        return;\n      }\n\n      if (scale < minScale || scale > maxScale) {\n        (0, _warning.default)(false, 'initialScale must be between minScale and maxScale.');\n        return;\n      }\n\n      var initialPosition;\n\n      if (position === 'center') {\n        (0, _warning.default)(initialTop === undefined, 'initialTop prop should not be supplied with position=center. It was ignored.');\n        (0, _warning.default)(initialLeft === undefined, 'initialLeft prop should not be supplied with position=center. It was ignored.');\n        initialPosition = {\n          top: (containerDimensions.width - imageDimensions.width * scale) / 2,\n          left: (containerDimensions.height - imageDimensions.height * scale) / 2\n        };\n      } else {\n        initialPosition = {\n          top: initialTop || 0,\n          left: initialLeft || 0\n        };\n      }\n\n      this.constrainAndApplyTransform(initialPosition.top, initialPosition.left, scale, 0, speed);\n    } //lifecycle methods\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var childElement = _react.default.Children.only(this.props.children);\n\n      var _this$props3 = this.props,\n          zoomButtons = _this$props3.zoomButtons,\n          maxScale = _this$props3.maxScale,\n          debug = _this$props3.debug;\n      var scale = this.state.scale;\n      var touchAction = this.controlOverscrollViaCss ? browserPanActions(this.state) || 'none' : undefined;\n      var containerStyle = {\n        width: '100%',\n        height: '100%',\n        overflow: 'hidden',\n        touchAction: touchAction\n      };\n      return _react.default.createElement(\"div\", {\n        style: containerStyle\n      }, zoomButtons && this.isImageReady && this.isTransformInitialized && _react.default.createElement(_ZoomButtons.default, {\n        scale: scale,\n        minScale: (0, _Utils.getMinScale)(this.state, this.props),\n        maxScale: maxScale,\n        onZoomOutClick: this.handleZoomOutClick,\n        onZoomInClick: this.handleZoomInClick\n      }), debug && _react.default.createElement(_StateDebugView.default, _extends({}, this.state, {\n        overflow: imageOverflow(this.state)\n      })), _react.default.cloneElement(childElement, {\n        onTouchStart: this.handleTouchStart,\n        onTouchEnd: this.handleTouchEnd,\n        onMouseDown: this.handleMouseDown,\n        onMouseMove: this.handleMouseMove,\n        onDoubleClick: this.handleMouseDoubleClick,\n        onWheel: this.handleMouseWheel,\n        onDragStart: _Utils.tryCancelEvent,\n        onLoad: this.handleImageLoad,\n        onContextMenu: _Utils.tryCancelEvent,\n        ref: this.handleRefImage,\n        style: imageStyle(this.state)\n      }));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener(\"resize\", this.handleWindowResize);\n      this.maybeHandleDimensionsChanged();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      this.maybeHandleDimensionsChanged();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.cancelAnimation();\n      this.imageRef.removeEventListener('touchmove', this.handleTouchMove);\n      window.removeEventListener('resize', this.handleWindowResize);\n    }\n  }, {\n    key: \"calculateNegativeSpace\",\n    value: function calculateNegativeSpace(scale) {\n      //get difference in dimension between container and scaled image\n      var _this$state4 = this.state,\n          containerDimensions = _this$state4.containerDimensions,\n          imageDimensions = _this$state4.imageDimensions;\n      var width = containerDimensions.width - scale * imageDimensions.width;\n      var height = containerDimensions.height - scale * imageDimensions.height;\n      return {\n        width: width,\n        height: height\n      };\n    }\n  }, {\n    key: \"cancelAnimation\",\n    value: function cancelAnimation() {\n      if (this.animation) {\n        cancelAnimationFrame(this.animation);\n      }\n    }\n  }, {\n    key: \"debug\",\n    value: function debug(message) {\n      if (this.props.debug) {\n        console.log(message);\n      }\n    }\n  }, {\n    key: \"isImageReady\",\n    get: function get() {\n      return this.isImageLoaded || this.imageRef && this.imageRef.tagName !== 'IMG';\n    }\n  }, {\n    key: \"isTransformInitialized\",\n    get: function get() {\n      return isInitialized(this.state.top, this.state.left, this.state.scale);\n    }\n  }, {\n    key: \"controlOverscrollViaCss\",\n    get: function get() {\n      return window.CSS && window.CSS.supports('touch-action', 'pan-up');\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, prevState) {\n      if (nextProps.initialTop !== prevState.initialTop || nextProps.initialLeft !== prevState.initialLeft || nextProps.initialScale !== prevState.initialScale || nextProps.position !== prevState.position) {\n        return {\n          position: nextProps.position,\n          initialScale: nextProps.initialScale,\n          initialTop: nextProps.initialTop,\n          initialLeft: nextProps.initialLeft\n        };\n      } else {\n        return null;\n      }\n    }\n  }]);\n\n  return PinchZoomPan;\n}(_react.default.Component);\n\nexports.default = PinchZoomPan;\nPinchZoomPan.defaultProps = {\n  initialScale: 'auto',\n  minScale: 'auto',\n  maxScale: 1,\n  position: 'topLeft',\n  zoomButtons: true,\n  doubleTapBehavior: 'reset'\n};\nPinchZoomPan.propTypes = {\n  children: _propTypes.default.element.isRequired,\n  initialScale: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string]),\n  minScale: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string]),\n  maxScale: _propTypes.default.number,\n  position: _propTypes.default.oneOf(['topLeft', 'center']),\n  zoomButtons: _propTypes.default.bool,\n  doubleTapBehavior: _propTypes.default.oneOf(['reset', 'zoom']),\n  initialTop: _propTypes.default.number,\n  initialLeft: _propTypes.default.number\n};"]},"metadata":{},"sourceType":"script"}