{"ast":null,"code":"// Generated by CoffeeScript 1.6.3\n(function () {\n  module.exports = function (_arg) {\n    var EQ, active, build_compare, delay, notifier, poll, run;\n    notifier = _arg.notifier, active = _arg.active, run = _arg.run;\n\n    EQ = function (a, b) {\n      return a === b;\n    };\n\n    delay = function () {\n      return setTimeout(arguments[1], arguments[0]);\n    };\n\n    build_compare = function (eq) {\n      return function (out1, out2) {\n        return eq(out1.result, out2.result) && eq(out1.error, out2.error);\n      };\n    };\n\n    poll = function (f, interval, eq) {\n      var compare, run_;\n\n      if (interval == null) {\n        interval = 100;\n      }\n\n      if (eq == null) {\n        eq = EQ;\n      }\n\n      run_ = function () {\n        return function (args) {\n          return run(f.apply(null, args));\n        }(arguments);\n      };\n\n      compare = build_compare(eq);\n      return function () {\n        var b, error, iter, monitor, out, result, stopped, _ref;\n\n        if (active()) {\n          _ref = out = run_(), result = _ref.result, error = _ref.error, monitor = _ref.monitor;\n\n          if (monitor != null) {\n            monitor.onChange(notifier());\n          } else {\n            b = notifier();\n            stopped = false;\n            b.onCancel(function () {\n              return stopped = true;\n            });\n            (iter = function () {\n              if (!stopped) {\n                return delay(interval, function () {\n                  if (!stopped) {\n                    if (compare(out, run_())) {\n                      return iter();\n                    } else {\n                      return b();\n                    }\n                  }\n                });\n              }\n            })();\n          }\n\n          if (out.error != null) {\n            throw out.error;\n          }\n\n          return out.result;\n        } else {\n          return f();\n        }\n      };\n    };\n\n    return poll;\n  };\n}).call(this);","map":null,"metadata":{},"sourceType":"script"}