{"ast":null,"code":"import setUnitDefShifts from '../utils/setUnitDefShifts';\nimport { prop, withId } from '../utils';\nexport default (function (lFamily, rFamily) {\n  var lChildren = lFamily.cUnits.reduce(function (a, b) {\n    return a.concat(b.nodes);\n  }, []);\n  var rChildren = rFamily.cUnits.reduce(function (a, b) {\n    return a.concat(b.nodes);\n  }, []);\n  var ids = lChildren.filter(function (node) {\n    return !!rChildren.find(withId(node.id));\n  }).map(prop('id'));\n  var shifts = lFamily.cUnits.map(prop('shift'));\n  lFamily.cUnits = lFamily.cUnits.sort(function (a, b) {\n    var foundA = !!a.nodes.find(function (node) {\n      return ids.indexOf(node.id) !== -1;\n    });\n    var foundB = !!b.nodes.find(function (node) {\n      return ids.indexOf(node.id) !== -1;\n    });\n    if (foundA && !foundB) return 1;else if (!foundA && foundB) return -1;\n    return 0;\n  });\n  lFamily.cUnits.forEach(function (unit, idx) {\n    return unit.shift = shifts[idx];\n  });\n  rFamily.cUnits = rFamily.cUnits.filter(function (unit) {\n    return !!unit.nodes.find(function (node) {\n      return ids.indexOf(node.id) === -1;\n    });\n  });\n  setUnitDefShifts(rFamily);\n});","map":{"version":3,"sources":["../../src/middle/fixOverlaps.ts"],"names":[],"mappings":"AAEA,OAAO,gBAAP,MAA6B,2BAA7B;AACA,SAAS,IAAT,EAAe,MAAf,QAA6B,UAA7B;AAIA,gBAAe,UAAC,OAAD,EAAkB,OAAlB,EAAqC;AAClD,MAAM,SAAS,GAAkB,OAAO,CAAC,MAAR,CAC9B,MAD8B,CACvB,UAAC,CAAD,EAAmB,CAAnB;AAAA,WAA+B,CAAC,CAAC,MAAF,CAAS,CAAC,CAAC,KAAX,CAA/B;AAAA,GADuB,EAC2B,EAD3B,CAAjC;AAEA,MAAM,SAAS,GAAkB,OAAO,CAAC,MAAR,CAC9B,MAD8B,CACvB,UAAC,CAAD,EAAmB,CAAnB;AAAA,WAA+B,CAAC,CAAC,MAAF,CAAS,CAAC,CAAC,KAAX,CAA/B;AAAA,GADuB,EAC2B,EAD3B,CAAjC;AAGA,MAAM,GAAG,GAAG,SAAS,CAAC,MAAV,CAAiB,UAAA,IAAI;AAAA,WAAI,CAAC,CAAC,SAAS,CAAC,IAAV,CAAe,MAAM,CAAC,IAAI,CAAC,EAAN,CAArB,CAAN;AAAA,GAArB,EAA4D,GAA5D,CAAgE,IAAI,CAAC,IAAD,CAApE,CAAZ;AACA,MAAM,MAAM,GAAG,OAAO,CAAC,MAAR,CAAe,GAAf,CAAmB,IAAI,CAAC,OAAD,CAAvB,CAAf;AAGA,EAAA,OAAO,CAAC,MAAR,GAAiB,OAAO,CAAC,MAAR,CAAe,IAAf,CAAoB,UAAC,CAAD,EAAI,CAAJ,EAAS;AAC5C,QAAM,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAF,CAAQ,IAAR,CAAa,UAAA,IAAI;AAAA,aAAI,GAAG,CAAC,OAAJ,CAAY,IAAI,CAAC,EAAjB,MAAyB,CAAC,CAA9B;AAAA,KAAjB,CAAjB;AACA,QAAM,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAF,CAAQ,IAAR,CAAa,UAAA,IAAI;AAAA,aAAI,GAAG,CAAC,OAAJ,CAAY,IAAI,CAAC,EAAjB,MAAyB,CAAC,CAA9B;AAAA,KAAjB,CAAjB;AAEA,QAAI,MAAM,IAAI,CAAC,MAAf,EAAuB,OAAO,CAAP,CAAvB,KACK,IAAI,CAAC,MAAD,IAAW,MAAf,EAAuB,OAAO,CAAC,CAAR;AAC5B,WAAO,CAAP;AACD,GAPgB,CAAjB;AAUA,EAAA,OAAO,CAAC,MAAR,CAAe,OAAf,CAAuB,UAAC,IAAD,EAAO,GAAP;AAAA,WAAe,IAAI,CAAC,KAAL,GAAa,MAAM,CAAC,GAAD,CAAlC;AAAA,GAAvB;AAGA,EAAA,OAAO,CAAC,MAAR,GAAiB,OAAO,CAAC,MAAR,CAAe,MAAf,CAAsB,UAAA,IAAI;AAAA,WACzC,CAAC,CAAC,IAAI,CAAC,KAAL,CAAW,IAAX,CAAgB,UAAA,IAAI;AAAA,aAAI,GAAG,CAAC,OAAJ,CAAY,IAAI,CAAC,EAAjB,MAAyB,CAAC,CAA9B;AAAA,KAApB,CADuC;AAAA,GAA1B,CAAjB;AAIA,EAAA,gBAAgB,CAAC,OAAD,CAAhB;AACD,CA5BD","sourceRoot":"","sourcesContent":["import setUnitDefShifts from '../utils/setUnitDefShifts';\nimport { prop, withId } from '../utils';\nexport default (lFamily, rFamily) => {\n    const lChildren = lFamily.cUnits\n        .reduce((a, b) => a.concat(b.nodes), []);\n    const rChildren = rFamily.cUnits\n        .reduce((a, b) => a.concat(b.nodes), []);\n    const ids = lChildren.filter(node => !!rChildren.find(withId(node.id))).map(prop('id'));\n    const shifts = lFamily.cUnits.map(prop('shift'));\n    lFamily.cUnits = lFamily.cUnits.sort((a, b) => {\n        const foundA = !!a.nodes.find(node => ids.indexOf(node.id) !== -1);\n        const foundB = !!b.nodes.find(node => ids.indexOf(node.id) !== -1);\n        if (foundA && !foundB)\n            return 1;\n        else if (!foundA && foundB)\n            return -1;\n        return 0;\n    });\n    lFamily.cUnits.forEach((unit, idx) => unit.shift = shifts[idx]);\n    rFamily.cUnits = rFamily.cUnits.filter(unit => (!!unit.nodes.find(node => ids.indexOf(node.id) === -1)));\n    setUnitDefShifts(rFamily);\n};\n//# sourceMappingURL=fixOverlaps.js.map"]},"metadata":{},"sourceType":"module"}