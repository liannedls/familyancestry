{"ast":null,"code":"// Generated by CoffeeScript 1.6.3\n(function () {\n  var Block,\n      X,\n      current,\n      reactivity,\n      stack,\n      __bind = function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  };\n\n  reactivity = require('reactivity');\n  /*\n  tree = build func\n  tree.error_handler = (e) -> console.log e\n  tree.invalidation_handler = -> console.log 'invalid. you should update now to exit and enter only affected nodes'\n  tree.update()\n  tree.enter()\n  tree.exit()\n  tree.invalid():Boolean\n  */\n\n  module.exports = X = function (func) {\n    var api, root_block;\n    api = {};\n    root_block = new Block(null, func);\n\n    root_block.error_handler = function (e) {\n      return typeof api.error_handler === \"function\" ? api.error_handler(e) : void 0;\n    };\n\n    root_block.invalidation_handler = function () {\n      return typeof api.invalidation_handler === \"function\" ? api.invalidation_handler() : void 0;\n    };\n\n    api.enter = function () {\n      return root_block.enter();\n    };\n\n    api.update = function () {\n      return root_block.update();\n    };\n\n    api.exit = function () {\n      return root_block.exit();\n    };\n\n    api.invalid = function () {\n      return root_block.descendant_invalid || root_block.invalid;\n    };\n\n    return api;\n  };\n\n  stack = [];\n\n  current = function () {\n    return stack[stack.length - 1];\n  };\n\n  X.sub = function (f) {\n    return current()._sub(f);\n  };\n\n  X.exit = function (f) {\n    return current()._exit(f);\n  };\n\n  X.invalidator = function () {\n    var b;\n    b = current();\n    return function () {\n      return b._invalidate();\n    };\n  };\n\n  Block = function () {\n    Block.prototype.invalid = false;\n    Block.prototype.descendant_invalid = false;\n\n    function Block(parent, func) {\n      this.parent = parent;\n      this.func = func;\n      this.update = __bind(this.update, this);\n      this.bubble_error = __bind(this.bubble_error, this);\n      this.bubble_invalidation = __bind(this.bubble_invalidation, this);\n      this.invalidate_by_parent = __bind(this.invalidate_by_parent, this);\n      this.invalidate_by_monitor = __bind(this.invalidate_by_monitor, this);\n      this.invalidate_by_func = __bind(this.invalidate_by_func, this);\n    }\n\n    Block.prototype._sub = function (f) {\n      var b;\n      b = new Block(this, f);\n      this.children.push(b);\n      return b.enter();\n    };\n\n    Block.prototype._exit = function (f) {\n      return this.exit_handler = f;\n    };\n\n    Block.prototype._invalidate = function () {\n      return this.invalidate_by_func();\n    };\n\n    Block.prototype.enter = function () {\n      var error,\n          monitor,\n          result,\n          _ref,\n          _this = this;\n\n      this.invalid = false;\n      this.descendant_invalid = false;\n      this.children = [];\n      this.exit_handler = null;\n      stack.push(this);\n      _ref = reactivity(function () {\n        return _this.func();\n      }), result = _ref.result, error = _ref.error, monitor = _ref.monitor;\n      stack.pop();\n\n      if (error != null) {\n        this.bubble_error(error);\n      }\n\n      if (monitor != null) {\n        (this.monitor = monitor).onChange(this.invalidate_by_monitor);\n      }\n\n      return result;\n    };\n\n    Block.prototype._invalidate = function (bubble) {\n      var c, _i, _len, _ref, _ref1;\n\n      if (bubble == null) {\n        bubble = false;\n      }\n\n      this.invalid = true;\n\n      if ((_ref = this.monitor) != null) {\n        _ref.destroy();\n      }\n\n      _ref1 = this.children;\n\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        c = _ref1[_i];\n        c.invalidate_by_parent();\n      }\n\n      if (bubble) {\n        return this.bubble_invalidation();\n      }\n    };\n\n    Block.prototype.invalidate_by_func = function () {\n      return this._invalidate(true);\n    };\n\n    Block.prototype.invalidate_by_monitor = function () {\n      return this._invalidate(true);\n    };\n\n    Block.prototype.invalidate_by_parent = function () {\n      return this._invalidate(false);\n    };\n\n    Block.prototype.bubble_invalidation = function () {\n      var _ref;\n\n      if (this.descendant_invalid) {\n        return;\n      }\n\n      this.descendant_invalid = true;\n\n      if (typeof this.invalidation_handler === \"function\") {\n        this.invalidation_handler();\n      }\n\n      return (_ref = this.parent) != null ? typeof _ref.bubble_invalidation === \"function\" ? _ref.bubble_invalidation() : void 0 : void 0;\n    };\n\n    Block.prototype.bubble_error = function (e) {\n      var _ref;\n\n      if ((_ref = this.parent) != null) {\n        if (typeof _ref.bubble_error === \"function\") {\n          _ref.bubble_error(e);\n        }\n      }\n\n      return typeof this.error_handler === \"function\" ? this.error_handler(e) : void 0;\n    };\n\n    Block.prototype.update = function () {\n      var c, _i, _len, _ref;\n\n      if (this.invalid) {\n        this.exit(true);\n        this.enter();\n      } else if (this.descendant_invalid) {\n        _ref = this.children;\n\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          c = _ref[_i];\n          c.update();\n        }\n      }\n\n      this.invalid = false;\n      return this.descendant_invalid = false;\n    };\n\n    Block.prototype.exit = function (we_are_the_topmost_exiting_node) {\n      var c, cs, _i, _len;\n\n      if (we_are_the_topmost_exiting_node == null) {\n        we_are_the_topmost_exiting_node = false;\n      }\n\n      (cs = this.children.concat()).reverse();\n\n      for (_i = 0, _len = cs.length; _i < _len; _i++) {\n        c = cs[_i];\n        c.exit();\n      }\n\n      if (typeof this.exit_handler === \"function\") {\n        this.exit_handler(we_are_the_topmost_exiting_node);\n      }\n\n      delete this.exit_handler;\n      return delete this.children;\n    };\n\n    return Block;\n  }();\n}).call(this);","map":{"version":3,"sources":["C:/Users/lianne/mygit/familyancestry/src/ftree/lib/index.js"],"names":["Block","X","current","reactivity","stack","__bind","fn","me","apply","arguments","require","module","exports","func","api","root_block","error_handler","e","invalidation_handler","enter","update","exit","invalid","descendant_invalid","length","sub","f","_sub","_exit","invalidator","b","_invalidate","prototype","parent","bubble_error","bubble_invalidation","invalidate_by_parent","invalidate_by_monitor","invalidate_by_func","children","push","exit_handler","error","monitor","result","_ref","_this","pop","onChange","bubble","c","_i","_len","_ref1","destroy","we_are_the_topmost_exiting_node","cs","concat","reverse","call"],"mappings":"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","sourcesContent":["// Generated by CoffeeScript 1.6.3\n(function() {\n  var Block, X, current, reactivity, stack,\n    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  reactivity = require('reactivity');\n\n  /*\n  tree = build func\n  tree.error_handler = (e) -> console.log e\n  tree.invalidation_handler = -> console.log 'invalid. you should update now to exit and enter only affected nodes'\n  tree.update()\n  tree.enter()\n  tree.exit()\n  tree.invalid():Boolean\n  */\n\n\n  module.exports = X = function(func) {\n    var api, root_block;\n    api = {};\n    root_block = new Block(null, func);\n    root_block.error_handler = function(e) {\n      return typeof api.error_handler === \"function\" ? api.error_handler(e) : void 0;\n    };\n    root_block.invalidation_handler = function() {\n      return typeof api.invalidation_handler === \"function\" ? api.invalidation_handler() : void 0;\n    };\n    api.enter = function() {\n      return root_block.enter();\n    };\n    api.update = function() {\n      return root_block.update();\n    };\n    api.exit = function() {\n      return root_block.exit();\n    };\n    api.invalid = function() {\n      return root_block.descendant_invalid || root_block.invalid;\n    };\n    return api;\n  };\n\n  stack = [];\n\n  current = function() {\n    return stack[stack.length - 1];\n  };\n\n  X.sub = function(f) {\n    return current()._sub(f);\n  };\n\n  X.exit = function(f) {\n    return current()._exit(f);\n  };\n\n  X.invalidator = function() {\n    var b;\n    b = current();\n    return function() {\n      return b._invalidate();\n    };\n  };\n\n  Block = (function() {\n    Block.prototype.invalid = false;\n\n    Block.prototype.descendant_invalid = false;\n\n    function Block(parent, func) {\n      this.parent = parent;\n      this.func = func;\n      this.update = __bind(this.update, this);\n      this.bubble_error = __bind(this.bubble_error, this);\n      this.bubble_invalidation = __bind(this.bubble_invalidation, this);\n      this.invalidate_by_parent = __bind(this.invalidate_by_parent, this);\n      this.invalidate_by_monitor = __bind(this.invalidate_by_monitor, this);\n      this.invalidate_by_func = __bind(this.invalidate_by_func, this);\n    }\n\n    Block.prototype._sub = function(f) {\n      var b;\n      b = new Block(this, f);\n      this.children.push(b);\n      return b.enter();\n    };\n\n    Block.prototype._exit = function(f) {\n      return this.exit_handler = f;\n    };\n\n    Block.prototype._invalidate = function() {\n      return this.invalidate_by_func();\n    };\n\n    Block.prototype.enter = function() {\n      var error, monitor, result, _ref,\n        _this = this;\n      this.invalid = false;\n      this.descendant_invalid = false;\n      this.children = [];\n      this.exit_handler = null;\n      stack.push(this);\n      _ref = reactivity(function() {\n        return _this.func();\n      }), result = _ref.result, error = _ref.error, monitor = _ref.monitor;\n      stack.pop();\n      if (error != null) {\n        this.bubble_error(error);\n      }\n      if (monitor != null) {\n        (this.monitor = monitor).onChange(this.invalidate_by_monitor);\n      }\n      return result;\n    };\n\n    Block.prototype._invalidate = function(bubble) {\n      var c, _i, _len, _ref, _ref1;\n      if (bubble == null) {\n        bubble = false;\n      }\n      this.invalid = true;\n      if ((_ref = this.monitor) != null) {\n        _ref.destroy();\n      }\n      _ref1 = this.children;\n      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n        c = _ref1[_i];\n        c.invalidate_by_parent();\n      }\n      if (bubble) {\n        return this.bubble_invalidation();\n      }\n    };\n\n    Block.prototype.invalidate_by_func = function() {\n      return this._invalidate(true);\n    };\n\n    Block.prototype.invalidate_by_monitor = function() {\n      return this._invalidate(true);\n    };\n\n    Block.prototype.invalidate_by_parent = function() {\n      return this._invalidate(false);\n    };\n\n    Block.prototype.bubble_invalidation = function() {\n      var _ref;\n      if (this.descendant_invalid) {\n        return;\n      }\n      this.descendant_invalid = true;\n      if (typeof this.invalidation_handler === \"function\") {\n        this.invalidation_handler();\n      }\n      return (_ref = this.parent) != null ? typeof _ref.bubble_invalidation === \"function\" ? _ref.bubble_invalidation() : void 0 : void 0;\n    };\n\n    Block.prototype.bubble_error = function(e) {\n      var _ref;\n      if ((_ref = this.parent) != null) {\n        if (typeof _ref.bubble_error === \"function\") {\n          _ref.bubble_error(e);\n        }\n      }\n      return typeof this.error_handler === \"function\" ? this.error_handler(e) : void 0;\n    };\n\n    Block.prototype.update = function() {\n      var c, _i, _len, _ref;\n      if (this.invalid) {\n        this.exit(true);\n        this.enter();\n      } else if (this.descendant_invalid) {\n        _ref = this.children;\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          c = _ref[_i];\n          c.update();\n        }\n      }\n      this.invalid = false;\n      return this.descendant_invalid = false;\n    };\n\n    Block.prototype.exit = function(we_are_the_topmost_exiting_node) {\n      var c, cs, _i, _len;\n      if (we_are_the_topmost_exiting_node == null) {\n        we_are_the_topmost_exiting_node = false;\n      }\n      (cs = this.children.concat()).reverse();\n      for (_i = 0, _len = cs.length; _i < _len; _i++) {\n        c = cs[_i];\n        c.exit();\n      }\n      if (typeof this.exit_handler === \"function\") {\n        this.exit_handler(we_are_the_topmost_exiting_node);\n      }\n      delete this.exit_handler;\n      return delete this.children;\n    };\n\n    return Block;\n\n  })();\n\n}).call(this);\n"]},"metadata":{},"sourceType":"module"}